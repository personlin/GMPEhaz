c ---------------------------------------------------------------------
C ** Chiou and Youngs (NGA West2-2013 Model) Horizontal **
C     Earthquake Spectra Paper:
C        Update of the Chiou and Youngs NGA Model for the
C            Average Horizontal Component of Peak
C            Ground Motion and Response Spectra
C         B. S.J. Chiou and R.R. Youngs
C     Notes:
C        Applicable Range (see Abstract):
C           3.5 <= M <= 8.5 Strike-slip
C           3.5 <= M <= 8.0 Reverse and Normal
C           Rrup <= 300 km
C           Ztor <= 20 km
C           180m/s <= Vs30m <= 1500m/s
C           Mainshock events only
C        Regional attenuation included based on Regionflag
C             0 = Global
C             1 = Japan/Italy
C             2 = Wenchuan (note only applicable for M7.9 event)
C         Sigma dependent on estimated or measured Vs30m based on
C             Vs30_Class
C             0 = Estimated Vs30m
C             1 = Measured Vs30m
c ---------------------------------------------------------------------

      Subroutine CY14_TW_B01 ( m, Rrup, Rbjf, specT,
     1                     period2, lnY, sigma, iflag,
     2                     vs, Delta, DTor, Ftype, depthvs10, vs30_class,
     3                     hwflag, Rx, regionflag, phi, tau )

C     Last Updated: 8/1/13

      parameter (MAXPER=25)
      REAL Period(MAXPER), C1(MAXPER), C1a(MAXPER), C1b(MAXPER)
      REAL cn(MAXPER), cm(MAXPER), c5(MAXPER), c6(MAXPER), c8(MAXPER)
      REAL c7(MAXPER), c9(MAXPER), gamma1(MAXPER), gamma2(MAXPER)
      REAL phi1(MAXPER), phi2(MAXPER), phi3(MAXPER), phi4(MAXPER)
      REAL phi5(MAXPER), phi6(MAXPER), phi1jp(MAXPER), phi5jp(MAXPER), phi6jp(MAXPER)
      REAL tau1(MAXPER), tau2(MAXPER), sigma1(MAXPER), sigma2(MAXPER)
      REAL sigma3(MAXPER), c9a(MAXPER)
      REAL c3(MAXPER), gm(MAXPER), c9b(MAXPER)
      Real CHM(MAXPER), C1c(MAXPER), C1d(MAXPER), C7b(MAXPER), C8b(MAXPER)
      real C11(MAXPER), C11B(MAXPER)
      real gscaleJapIt(MAXPER), gscaleWen(MAXPER), sigma2Jap(MAXPER)

      REAL c1T, c1aT, c1bT, cnT, cmT, c5T, c6T, c7T, c9T, c9aT, c3T, c8T
      REAL gamma1T, gamma2T, phi1T, phi2T, phi3T, phi4T, sigma3T
      REAL phi5T, phi6T, tau1T, tau2T, sigma1T, sigma2T
      real C1cT, C1dT, C7bT, C11T, C11bT, CHMT
      REAL c2, c4, c4a, cRB, pi, d2r, gamma, gmT, c9bT
      real cc, cosdelta, r1, r2, r3, r4, hw, psa_ref, psa, a, b, c
      integer iflag, count1, count2, hwflag, vs30_class, regionflag
      REAL M, RRUP, RBJF, DTOR, Delta, specT, sigma, Ftype, Rx
      REAL period2, lnY, F_RV, F_NM, depthvs10, tau, rkdepth
      real c8a, c8bT, deltaZ1, fd
      real NL0, sigma_NL0, F_Measured, F_Inferred, mz_TOR, deltaZ_TOR, coshM
      real gscaleJapItT, gscaleWenT, sigma2JapT, phi
      real phi1jpT, phi5jpT, phi6jpT

      Data period / 0, 0.01, 0.02, 0.03, 0.04, 0.05, 0.075, 0.1, 0.12, 0.15, 0.17, 0.2, 0.25, 0.3, 0.4, 0.5, 0.75, 1, 1.5, 2, 3, 4,
     1      5, 7.5, 10/
      Data c1 / -1.4140450473381, -1.4140450473381, -1.37176453677897, -1.24332932695284, -1.0802872333995, -0.906769435427789,
     1      -0.572074566554073, -0.436430195188701, -0.407145538036083, -0.4618900447395, -0.51538461661769, -0.604447694148089,
     1      -0.794021218549838, -0.981291927899483, -1.36025958749137, -1.64568520778537, -2.22100267138008, -2.57258448220325,
     1      -3.10786755642744, -3.40347445995744, -3.85566015197897, -4.06788680471119, -4.2039754451319, -4.46883137865294,
     1      -4.74160378430361/
      Data c1a / 0.102309988540628, 0.102309988540628, 0.0982153670135461, 0.0681604009412575, 0.0310363328260798,
     1      -0.0123809990857504, -0.0704818570736638, -0.0423880519765062, -0.00392685522028374, 0.0768630641381616,
     1      0.11303803706335, 0.172689282002819, 0.256172322223617, 0.303551458736533, 0.364164343545107, 0.389920604951595,
     1      0.339572641434102, 0.286828223819104, 0.242752717916376, 0.219400943949343, 0.157012741130622, 0.0279417772605397,
     1      -0.0223946859800102, -0.210595526241349, -0.234042928779765/
      Data c1b / -0.137001571489968, -0.137001571489968, -0.122640340188536, -0.138309663279013, -0.150849184781702,
     1      -0.221692186664873, -0.279860158630155, -0.248958546838227, -0.219567323558856, -0.135383761270543,
     1      -0.0882334931360253, -0.0464480157160398, 0.00508271877366316, -0.0296377758155838, -0.0721276605028521,
     1      -0.0953425200395264, -0.15651106294951, -0.308786053337892, -0.357703763911231, -0.327088614701454, -0.182387487752057,
     1      0.0039814424879218, 0.0663187156713977, -0.16201793279742, -0.539287141258332/
      Data c1c / 0.203780460779788, 0.203780460779788, 0.213694842503973, 0.276454091242583, 0.36221996745238, 0.447366336439733,
     1      0.525644938946469, 0.414324487707683, 0.322292715812068, 0.140178388323425, 0.0828322354203124, 0.00828807875660214,
     1      -0.140369804535501, -0.25432150524625, -0.329456595344357, -0.360019415180797, -0.220516065434544, -0.0890135251725608,
     1      -0.0510028840074567, -0.0467489819570397, 0.00510930859275142, 0.143857312540873, 0.212262327139431, 0.355561999126219,
     1      0.577603044545488/
      Data c1d / 0.0975540606896868, 0.0975540606896868, 0.0760488911235876, 0.0935579325948248, 0.135861689979087,
     1      0.242803848034164, 0.302709548688855, 0.166891771792091, 0.154032487655319, 0.0912158968383778, 0.0346227957563348,
     1      -0.0183414437150981, -0.0844645801041408, -0.0241086223780826, 0.0541927908340363, 0.0308718111023742,
     1      0.102180666516917, 0.278353767077533, 0.39595714347126, 0.40574368961906, 0.394460279594511, 0.307162489481409,
     1      -0.438186225300125, 0.0467921706662065, 0.40504355161506/
      Data cn / 16.0875, 16.0875, 15.7118, 15.8819, 16.4556, 17.6453, 20.1772, 19.9992, 18.7106, 16.6246, 15.3709, 13.7012,
     1      11.2667, 9.1908, 6.5459, 5.2305, 3.7896, 3.3024, 2.8498, 2.5417, 2.1488, 1.8957, 1.7228, 1.5737, 1.5265/
      Data cM / 4.9993, 4.9993, 4.9993, 4.9993, 4.9993, 4.9993, 5.0031, 5.0172, 5.0315, 5.0547, 5.0704, 5.0939, 5.1315, 5.167,
     1      5.2317, 5.2893, 5.4109, 5.5106, 5.6705, 5.7981, 5.9983, 6.1552, 6.2856, 6.5428, 6.7415/
      Data c3 / 1.12148533979985, 1.12148533979985, 1.0904354580561, 1.05573210579185, 1.05168701472023, 1.04937762737848,
     1      1.14696901834536, 1.16573916859034, 1.20456942898642, 1.25744622432626, 1.28421830745966, 1.34331518554256,
     1      1.44014314544337, 1.58240561675005, 1.75209274237095, 1.86135066163668, 2.20036086194074, 2.50105825254513,
     1      2.77407276516171, 2.90039712895832, 2.98876617678323, 3.03960075884076, 3.05852404169153, 3.12844673965058,
     1      3.09448745389871/
      Data c5 / 6.4551, 6.4551, 6.4551, 6.4551, 6.4551, 6.4551, 6.4551, 6.8305, 7.1333, 7.3621, 7.4365, 7.4972, 7.5416, 7.56,
     1      7.5735, 7.5778, 7.5808, 7.5814, 7.5817, 7.5818, 7.5818, 7.5818, 7.5818, 7.5818, 7.5818/
      Data cHM / 3.0956, 3.0956, 3.0963, 3.0974, 3.0988, 3.1011, 3.1094, 3.2381, 3.3407, 3.43, 3.4688, 3.5146, 3.5746, 3.6232,
     1      3.6945, 3.7401, 3.7941, 3.8144, 3.8284, 3.833, 3.8361, 3.8369, 3.8376, 3.838, 3.838/
      Data c6 / 0.4908, 0.4908, 0.4925, 0.4992, 0.5037, 0.5048, 0.5048, 0.5048, 0.5048, 0.5045, 0.5036, 0.5016, 0.4971, 0.4919,
     1      0.4807, 0.4707, 0.4575, 0.4522, 0.4501, 0.45, 0.45, 0.45, 0.45, 0.45, 0.45/
      Data c7 / 0.0227540996361269, 0.0227540996361269, 0.0227552100388193, 0.0235467084368108, 0.02508084060929,
     1      0.0268924173655191, 0.0301522510162918, 0.0320087847635616, 0.0319436760482508, 0.0313169054564934, 0.0304817601129851,
     1      0.028180910759688, 0.0242345943533766, 0.022709710687586, 0.020389915528851, 0.0178414154282089, 0.0138124718703628,
     1      0.012833389253959, 0.00980597384650225, 0.0075575148559342, -0.00243386255499375, -0.0113663782002742,
     1      -0.0167895056453914, -0.0199598627932712, -0.0248446172455468/
      Data c7b / 0.00926727390127283, 0.00926727390127283, 0.00967525394998218, 0.011096932514164, 0.0115503733884441,
     1      0.0103384674144947, 0.00618860221704959, -0.000160933016994053, -0.00208761363187096, -0.00544740849802069,
     1      -0.0053196602042092, -0.0041218812882198, -0.000152275789990864, 0.00185095029124472, 0.00288348448139767,
     1      0.0042925178880974, 0.0102053170112664, 0.0117869159296381, 0.00954053713918428, 0.00864491384338065,
     1      0.0130526799595223, 0.0249648426440029, 0.0395151902995312, 0.0452594205768686, 0.0596440837726354/
      Data c8b / 0.4833, 0.4833, 1.2144, 1.6421, 1.9456, 2.181, 2.6087, 2.9122, 3.1045, 3.3399, 3.4719, 3.6434, 3.8787, 4.0711,
     1      4.3745, 4.6099, 5.0376, 5.3411, 5.7688, 6.0723, 6.5, 6.8035, 7.0389, 7.4666, 7.77/
      Data c9 / 0.9228, 0.9228, 0.9296, 0.9396, 0.9661, 0.9794, 1.026, 1.0177, 1.0008, 0.9801, 0.9652, 0.9459, 0.9196, 0.8829,
     1      0.8302, 0.7884, 0.6754, 0.6196, 0.5101, 0.3917, 0.1244, 0.0086, 0, 0, 0/
      Data c9a / 0.1202, 0.1202, 0.1217, 0.1194, 0.1166, 0.1176, 0.1171, 0.1146, 0.1128, 0.1106, 0.115, 0.1208, 0.1208, 0.1175,
     1      0.106, 0.1061, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1/
      Data c9b / 6.8607, 6.8607, 6.8697, 6.9113, 7.0271, 7.0959, 7.3298, 7.2588, 7.2372, 7.2109, 7.2491, 7.2988, 7.3691, 6.8789,
     1      6.5334, 6.526, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5/
      Data c11 / 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0/
      Data c11b / -0.4536, -0.4536, -0.4536, -0.4536, -0.4536, -0.4536, -0.4536, -0.4536, -0.4536, -0.4536, -0.4536, -0.444,
     1      -0.3539, -0.2688, -0.1793, -0.1428, -0.1138, -0.1062, -0.102, -0.1009, -0.1003, -0.1001, -0.1001, -0.1, -0.1/
      Data gamma1 / -0.00781332801787258, -0.00781332801787258, -0.00785308625206718, -0.00787413052251551, -0.00805510858276557,
     1      -0.0085753508201641, -0.00969647625043213, -0.010830811199557, -0.0111108110295715, -0.0122041951472858,
     1      -0.0121435187837781, -0.0118136493162099, -0.011277049271321, -0.00993962130216928, -0.00740537587225158,
     1      -0.00526653108552609, -0.00341141337163772, -0.00359455845378265, -0.00438901137346104, -0.00502515807389721,
     1      -0.0041379060902553, -0.00375919175946848, -0.00291870254612293, -0.00375180790411696, -0.00250230825101929/
      Data gamma2 / -0.0121138497289449, -0.0121138497289449, -0.0123896315961327, -0.0144586764408269, -0.015746013409203,
     1      -0.0156118038236174, -0.0137225737980549, -0.00956318713392115, -0.00754412741203512, -0.0035298140599342,
     1      -0.00239773117640817, -0.00126127051940569, 0.000211534011549016, -0.000296735432825053, -0.00137024050333717,
     1      -0.00340730010853568, -0.00644211107230501, -0.00737377129239285, -0.00358817979423838, -0.0020736804142545,
     1      0.000639358156249551, 0.00304656666211752, 0.0023518097026427, 0.013393506626236, 0.0134555084242695/
      Data gm / 4.2542, 4.2542, 4.2386, 4.2519, 4.296, 4.3578, 4.5455, 4.7603, 4.8963, 5.0644, 5.1371, 5.188, 5.2164, 5.1954,
     1      5.0899, 4.7854, 4.3304, 4.1667, 4.0029, 3.8949, 3.7928, 3.7443, 3.709, 3.6632, 3.623/
      Data phi1 / -0.463097965981629, -0.463097965981629, -0.453238588525087, -0.437149110750702, -0.415500125303963,
     1      -0.389892120731303, -0.377834899710583, -0.404973590660776, -0.429326620658653, -0.455862432310297, -0.472240417192964,
     1      -0.484050992479871, -0.505694903395291, -0.556735660001806, -0.628664568719498, -0.667012502830636, -0.848364060486137,
     1      -0.972047647232123, -1.09320530334886, -1.11060141139862, -1.11058671389735, -1.08421732921794, -1.02273047950467,
     1      -0.949843656011839, -0.852771827525695/
      Data phi2 / -0.1417, -0.1417, -0.1364, -0.1403, -0.1591, -0.1862, -0.2538, -0.2943, -0.3077, -0.3113, -0.3062, -0.2927,
     1      -0.2662, -0.2405, -0.1975, -0.1633, -0.1028, -0.0699, -0.0425, -0.0302, -0.0129, -0.0016, 0, 0, 0/
      Data phi3 / -4.96041757793564, -4.96041757793564, -4.92276178884602, -4.91251089610306, -4.96513625402504, -5.04104295651768,
     1      -5.16134191152096, -5.18427465050738, -5.16799110487246, -5.14216868405811, -5.1228525972173, -5.09276768363488,
     1      -5.04538203042609, -5.00505091580236, -4.94414555282742, -4.90155669907002, -4.81342512480855, -4.77429914899606,
     1      -4.86562627218628, -5.34080741816899, -6.30453280595018, -6.48707320506911, -6.54311216539423, -6.59367473267582,
     1      -6.59953555531281/
      Data phi4 / -2.28130316824122, -2.28130316824122, -2.22229626176524, -2.12119730536018, -2.01259817873199, -1.90429902597891,
     1      -1.65759927434112, -1.4668018434511, -1.37369802906703, -1.32250111763273, -1.3277990635296, -1.36550006882328,
     1      -1.4629983153057, -1.5736992160094, -1.79900163048511, -2.01119988561788, -2.46330564055044, -2.83710591027157,
     1      -3.44869787781101, -3.92632479013901, -4.64152301545389, -5.22525279569103, -5.73744267614884, -6.78200407367658,
     1      -7.57134365730054/
      Data phi5 / -0.0188268108263643, -0.0188268108263643, -0.0184818430596974, -0.0196745059490935, -0.0194223587436344,
     1      -0.0207815196274008, -0.00593869912772984, 0.0194435147403153, 0.0099388678757546, -0.00414914760399357,
     1      -0.0163518880095226, -0.0182308233822299, -0.0151106666550766, -0.0150390030113457, -0.00558751468731073,
     1      -0.00304685428289503, 0.0144180248565366, 0.0329628133910849, 0.0974779516826341, 0.128760002528675, 0.156067130382465,
     1      0.13360707079741, 0.115813794436167, 0.108780258890814, 0.0837078780345177/
      Data phi6 / 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300,
     1      300, 300, 300/
      Data tau1 / 0.4, 0.4, 0.40260697107594, 0.406254677901244, 0.409536599100115, 0.412362151356064, 0.417868294570895,
     1      0.421889928589278, 0.424427487574697, 0.427481452707345, 0.429157682348667, 0.431284929241235, 0.434101130455258,
     1      0.436302393283048, 0.439579110622969, 0.441948893180584, 0.445868511544276, 0.448355188391465, 0.451470005001172,
     1      0.453423408395737, 0.455849456889221, 0.457360780855491, 0.458424490145996, 0.460138736069957, 0.461201624142458/
      Data tau2 / 0.26, 0.26, 0.2637242443942, 0.268935254144634, 0.273623713000165, 0.277660216222949, 0.285526135101279,
     1      0.291271326556111, 0.294896410820996, 0.29925921815335, 0.301653831926667, 0.304692756058908, 0.308715900650368,
     1      0.311860561832925, 0.316541586604241, 0.319926990257977, 0.325526445063252, 0.329078840559236, 0.333528578573103,
     1      0.336319154851053, 0.339784938413173, 0.341943972650702, 0.343463557351422, 0.345912480099939, 0.347430891632083/
      Data sigma1 / 0.491174072226289, 0.491174072226289, 0.490392102266757, 0.49884629286719, 0.504893375136174,
     1      0.509564336873576, 0.517904200145505, 0.523587992281292, 0.526987000584287, 0.530830818870199, 0.532795897236441,
     1      0.535092985589259, 0.537693444822054, 0.539459005039374, 0.542235827503619, 0.543286483861406, 0.529446500271604,
     1      0.510487062001946, 0.478270612673322, 0.468082689790949, 0.461651268718433, 0.457088102848047, 0.453548636419445,
     1      0.447117215346928, 0.442554049476542/
      Data sigma2 / 0.376232982006498, 0.376232982006498, 0.376232982006498, 0.384851051972815, 0.390965669923574,
     1      0.395708536077288, 0.404326606043605, 0.410441223994364, 0.414316427806967, 0.419059293960682, 0.421719608502208,
     1      0.42517391191144, 0.429916778065155, 0.433791981877758, 0.439906599828517, 0.444649465982231, 0.453267535948548,
     1      0.459382153899307, 0.468000223865624, 0.468082689790949, 0.461651268718433, 0.457088102848047, 0.453548636419445,
     1      0.447117215346928, 0.442554049476542/
      Data sigma3 / 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.7999, 0.7997, 0.7988, 0.7966, 0.7792, 0.7504,
     1      0.7136, 0.7035, 0.7006, 0.7001, 0.7, 0.7, 0.7/
      Data gscaleJapIt / 1.581682, 1.581682, 1.574012, 1.554376, 1.550154, 1.539148, 1.480416, 1.40939, 1.368192, 1.324078,
     1      1.307137, 1.293133, 1.314989, 1.351437, 1.405064, 1.440233, 1.52797, 1.652328, 1.887186, 2.134757, 3.575186, 3.864586,
     1      3.729218, 2.376267, 1.767935/
      Data phi1Jp / -0.684621362856666, -0.684621362856666, -0.668104490153807, -0.631364652348356, -0.585522686567435,
     1      -0.545659123699481, -0.468510173737368, -0.498485421565652, -0.560262194908129, -0.645129113225058, -0.698050600056553,
     1      -0.765310551536843, -0.846945325590174, -0.899885267655382, -0.961772613950091, -0.994485940646074, -1.02254530165975,
     1      -1.0001741238606, -0.924505251934862, -0.862638634236657, -0.788170491672007, -0.719494506504419, -0.655991993310966,
     1      -0.520223846723544, -0.406803274628334/
      Data phi5Jp / 0.459, 0.459, 0.458, 0.462, 0.453, 0.436, 0.383, 0.375, 0.377, 0.379, 0.38, 0.384, 0.393, 0.408, 0.462, 0.524,
     1      0.658, 0.78, 0.96, 1.11, 1.291, 1.387, 1.433, 1.46, 1.464/
      Data phi6Jp / 800, 800, 800, 800, 800, 800, 800, 800, 800, 800, 800, 800, 800, 800, 800, 800, 800, 800, 800, 800, 800, 800,
     1      800, 800, 800/
      Data gscaleWen / 0.75937, 0.75937, 0.760565, 0.76416, 0.767627, 0.773871, 0.795556, 0.79319, 0.776833, 0.743674, 0.721908,
     1      0.692222, 0.657901, 0.636173, 0.604851, 0.550656, 0.358158, 0.200263, 0.035633, 0, 0, 0, 0, 0, 0/
      Data sigma2jap / 0.452832136505141, 0.452832136505141, 0.455081474488854, 0.457089607558063, 0.464232248075043,
     1      0.471593304149618, 0.502235058788957, 0.522972224766759, 0.527828908598616, 0.530427671390517, 0.530985974389397,
     1      0.531176947346726, 0.53091866775, 0.53069348684478, 0.530953922960708, 0.531256171294916, 0.530904125925903,
     1      0.53016308922439, 0.527603492956116, 0.516719512970182, 0.491681001472351, 0.468235579988731, 0.451748161403632,
     1      0.416734686252964, 0.375505067353143/
      Data c8 / 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0991,0.1982,0.2154,0.2154,0.2154,0.2154,0.2154,0.2154,0.2154,0.2154/

C Find the requested spectral period and corresponding coefficients
      nPer = 25
C First check for the PGA case (i.e., specT=0.0)
      if (specT .eq. 0.0) then
         period1  = period(1)
         c1T      = c1(1)
         c1aT     = c1a(1)
         c1bT     = c1b(1)
         c1cT     = c1c(1)
         c1dT     = c1d(1)
         c3T      = c3(1)
         cHMT     = CHM(1)
         cnT      = cn(1)
         cmT      = cm(1)
         c5T      = c5(1)
         c6T      = c6(1)
         c7T      = c7(1)
         c7bT      = c7b(1)
         c8bT      = c8b(1)
         c9T      = c9(1)
         c9aT      = c9a(1)
         c9bT      = c9b(1)
         c11T      = c11(1)
         c11bT      = c11b(1)
         gamma1T  = gamma1(1)
         gamma2T  = gamma2(1)
         gmT      = gm(1)
         phi1T    = phi1(1)
         phi2T    = phi2(1)
         phi3T    = phi3(1)
         phi4T    = phi4(1)
         phi5T    = phi5(1)
         phi6T    = phi6(1)
         tau1T    = tau1(1)
         tau2T    = tau2(1)
         sigma1T = sigma1(1)
         sigma2T = sigma2(1)
         sigma2JapT = sigma2Jap(1)
         sigma3T = sigma3(1)
         gscaleJapItT = gscaleJapIt(1)
         phi1jpT = phi1jp(1)
         phi5jpT = phi5jp(1)
         phi6jpT = phi6jp(1)
         gscaleWenT = gscaleWen(1)
         c8T = c8(1)
         goto 1011
      elseif (specT .gt. 0.0) then
C Now loop over the spectral period range of the attenuation relationship.
         do i=2,nper-1
            if (specT .ge. period(i) .and. specT .le. period(i+1) ) then
               count1 = i
               count2 = i+1
               goto 1020
            endif
         enddo
      endif

C Selected spectral period is outside range defined by attenuaton model.
c     write statement removed for R package compliance
c     write statement removed for R package compliance
c     write statement removed for R package compliance
c     write statement removed for R package compliance
c     write statement removed for R package compliance
c     write statement removed for R package compliance
c     write statement removed for R package compliance
c     write statement removed for R package compliance
c     write statement removed for R package compliance
c     write statement removed for R package compliance
      return

C Interpolate the coefficients for the requested spectral period.
 1020       call interp (period(count1),period(count2),c1(count1),c1(count2),
     +                   specT,c1T,iflag)
            call interp (period(count1),period(count2),c1a(count1),c1a(count2),
     +                   specT,c1aT,iflag)
            call interp (period(count1),period(count2),c1b(count1),c1b(count2),
     +                   specT,c1bT,iflag)
            call interp (period(count1),period(count2),c1c(count1),c1c(count2),
     +                   specT,c1cT,iflag)
            call interp (period(count1),period(count2),c1d(count1),c1d(count2),
     +                   specT,c1dT,iflag)
            call interp (period(count1),period(count2),cn(count1),cn(count2),
     +                   specT,cnT,iflag)
            call interp (period(count1),period(count2),cm(count1),cm(count2),
     +                   specT,cmT,iflag)
            call interp (period(count1),period(count2),cHM(count1),cHM(count2),
     +                   specT,cHMT,iflag)
            call interp (period(count1),period(count2),c3(count1),c3(count2),
     +                   specT,c3T,iflag)
            call interp (period(count1),period(count2),c5(count1),c5(count2),
     +                   specT,c5T,iflag)
            call interp (period(count1),period(count2),c6(count1),c6(count2),
     +                   specT,c6T,iflag)
            call interp (period(count1),period(count2),c7(count1),c7(count2),
     +                   specT,c7T,iflag)
            call interp (period(count1),period(count2),c7b(count1),c7b(count2),
     +                   specT,c7bT,iflag)
            call interp (period(count1),period(count2),c8b(count1),c8b(count2),
     +                   specT,c8bT,iflag)
            call interp (period(count1),period(count2),c9(count1),c9(count2),
     +                   specT,c9T,iflag)
            call interp (period(count1),period(count2),c9a(count1),c9a(count2),
     +                   specT,c9aT,iflag)
            call interp (period(count1),period(count2),c9b(count1),c9b(count2),
     +                   specT,c9bT,iflag)
            call interp (period(count1),period(count2),c11(count1),c11(count2),
     +                   specT,c11T,iflag)
            call interp (period(count1),period(count2),c11b(count1),c11b(count2),
     +                   specT,c11bT,iflag)
            call interp (period(count1),period(count2),gamma1(count1),gamma1(count2),
     +                   specT,gamma1T,iflag)
            call interp (period(count1),period(count2),gamma2(count1),gamma2(count2),
     +                   specT,gamma2T,iflag)
            call interp (period(count1),period(count2),gm(count1),gm(count2),
     +                   specT,gmT,iflag)
            call interp (period(count1),period(count2),phi1(count1),phi1(count2),
     +                   specT,phi1T,iflag)
            call interp (period(count1),period(count2),phi2(count1),phi2(count2),
     +                   specT,phi2T,iflag)
            call interp (period(count1),period(count2),phi3(count1),phi3(count2),
     +                   specT,phi3T,iflag)
            call interp (period(count1),period(count2),phi4(count1),phi4(count2),
     +                   specT,phi4T,iflag)
            call interp (period(count1),period(count2),phi5(count1),phi5(count2),
     +                   specT,phi5T,iflag)
            call interp (period(count1),period(count2),phi6(count1),phi6(count2),
     +                   specT,phi6T,iflag)
            call interp (period(count1),period(count2),tau1(count1),tau1(count2),
     +                   specT,tau1T,iflag)
            call interp (period(count1),period(count2),tau2(count1),tau2(count2),
     +                   specT,tau2T,iflag)
            call interp (period(count1),period(count2),sigma1(count1),sigma1(count2),
     +                   specT,sigma1T,iflag)
            call interp (period(count1),period(count2),sigma2(count1),sigma2(count2),
     +                   specT,sigma2T,iflag)
            call interp (period(count1),period(count2),sigma2Jap(count1),sigma2Jap(count2),
     +                   specT,sigma2JapT,iflag)
            call interp (period(count1),period(count2),sigma3(count1),sigma3(count2),
     +                   specT,sigma3T,iflag)
            call interp (period(count1),period(count2),gscaleJapIt(count1),gscaleJapIt(count2),
     +                   specT,gscaleJapItT,iflag)
            call interp (period(count1),period(count2),phi1jp(count1),phi1jp(count2),
     +                   specT,phi1jpT,iflag)
            call interp (period(count1),period(count2),phi5jp(count1),phi5jp(count2),
     +                   specT,phi5jpT,iflag)
            call interp (period(count1),period(count2),phi6jp(count1),phi6jp(count2),
     +                   specT,phi6jpT,iflag)
            call interp (period(count1),period(count2),gscaleWen(count1),gscaleWen(count2),
     +                   specT,gscaleWenT,iflag)
            call interp (period(count1),period(count2),c8(count1),c8(count2),
     +                   specT,c8T,iflag)

 1011 period1 = specT

c     Set the fault mechanism term.
C     fType     Mechanism                      Rake
C     ------------------------------------------------------
C      -1       Normal                   -120 < Rake < -60.0
C     1, 0.5    Reverse and Rev/Obl        30 < Rake < 150.0
C     0,-0.5    Strike-Slip and NMl/Obl        Otherwise
         if (ftype .eq. -1) then
            F_RV = 0.0
            F_NM = 1.0
         elseif (ftype .ge. 0.5) then
            F_RV = 1.0
            F_NM = 0.0
         else
            F_RV = 0.0
            F_NM = 0.0
         endif

C     Constant terms
        c2 = 1.06
        c4 = -2.1
        c4a = -0.5
        cRB = 50.0
C        c8 = 0.2154
        c8a = 0.2695

        pi = atan(1.0)*4.0
        d2r = pi/180.0

        cc = c5T* cosh(c6T * max((M-cHMT),0.0))
        gamma = gamma1T + gamma2T/cosh(max((M-gmT),0.0))
C     Apply Regional scaling factor.
C     Regionflag = 0 Global
C     Regionflag = 1 Japan and Italy
C        Also set sigma2 equal to Japan specific value
C     Regionflag = 2 Wenchuan (note only for M7.9)
        if (regionflag .eq. 1 ) then
           gamma = gamma * gscaleJapItT
           sigma2T = sigma2JapT
        elseif (regionflag .eq. 2) then
           gamma = gamma * gscaleWenT
        endif

        cosDELTA = cos(abs(DELTA)*d2r)

c Magnitude scaling
        r1 = c1T + c2 * (M-6.0) +
     1       (c2-c3T)/cnT *
     1             alog(1.0 + exp(cnT*(cMT-M)))

c Near-field magnitude and distance scaling
        r2 = c4 * alog(Rrup + cc)

c Distance scaling at large distance
        r3 = (c4a-c4)/2.0 *
     1            alog( Rrup*Rrup+cRB*cRB ) +
     1       Rrup * gamma

c Center Z_TOR on the Z_TOR-M relation in Chiou and Youngs (2013)
        if (F_RV.EQ.1) then
          if (M .le. 5.849) then
              mZ_TOR = 2.704*2.704
          else
              mZ_TOR = max(2.704-1.226*(M-5.849), 0.0)
              mZ_TOR = mZ_TOR * mZ_TOR
          endif
        else
          if (M .le. 4.970) then
              mZ_TOR = 2.673*2.673
          else
              mZ_TOR = max(2.673-1.136*(M-4.970), 0.0)
              mZ_TOR = mZ_TOR * mZ_TOR
          endif
        endif
        deltaZ_TOR = Dtor - mZ_TOR

c Scaling with other source variables (F_RV, F_NM, deltaZ_TOR, and Dip)
        coshM = cosh(2*max(M-4.5,0.0))
        cosDELTA = cos(DELTA*d2r)
        r4 = (c1aT+c1cT/coshM) * F_RV +
     1       (c1bT+c1dT/coshM) * F_NM +
     1       (c7T +c7bT/coshM) * deltaZ_TOR +
     1       (c11T+c11bT/coshM)* cosDELTA**2

c HW effect
        if (HWFlag .eq. 0) then
           hw = 0.0
        else
         hw = c9T * (cosDELTA) * (c9aT+(1-c9aT)
     1        *tanh(Rx/c9bT)) *
     1          (1.0 - sqrt(Rbjf**2+DTor**2)/(Rrup + 1))
        endif

C     Current version of the code sets cDPP=0 (i.e., no directivity)
c Directivity effect
c        cDPP = 0.0
c        fd = c8T * exp(-c8aT * (M-c8bT)**2) *
c     1       max(0.0, 1.0-max(0.0,Rrup-40.0)/30.0) *
c     1       min(max(0.0,M-5.5)/0.8, 1.0) * cDPP

c Predicted median Sa on reference condition (Vs=1130 m/sec)
        fd = 0.0
        psa_ref = r1+r2+r3+r4+hw+fd

C     Set Phi1, Phi5, and Phi6 term for Japan is region is requested
        if (regionflag .eq. 1) then
           phi1T = phi1jpT
           phi5T = phi5jpT
           phi6T = phi6jpT
        endif

c Linear soil amplification
        a = phi1T * min(alog(Vs/1130.0), 0.0)

c Nonlinear soil amplification
        b = phi2T *
     1      (exp(-exp(phi3T)*(min(Vs,1130.0)-360.0)) - exp(-exp(phi3T)*(1130.0-360.0)))
        c = exp(phi4T)

C Deviation from ln(Vs30) scaling: bedrock depth (Z1) effect.
        if (regionflag .eq. 1) then
           deltaZ1 = depthvs10*1000.0 -
     1     exp(-5.23/2.0 * alog((VS**2.0 + 412.0**2.0)/(1360.0**2.0 + 412.0**2.0)))
        else
           deltaZ1 = depthvs10*1000.0 -
     1     exp(-2.63 / 4.0 * alog((VS**4.0 + 253.0**4.0)/(2492.0**4.0 + 253.0**4.0)))
        endif
        rkdepth = phi5T * ( 1.0 - exp(-deltaZ1/phi6T ) )

c Sa on soil condition
        psa = psa_ref + (a + b * alog((exp(psa_ref)+c)/c)) + rkdepth

C Compute the sigma term

        NL0 = b * exp(psa_ref)/(exp(psa_ref)+c)
        tau = tau1T +
     1            (tau2T-tau1T)/1.5*(min(max(M,5.0),6.5)-5.0)
        sigma_NL0 = sigma1T +
     1              (sigma2T-sigma1T)/1.5*(min(max(M,5.0),6.5)-5.0)
C     Current code set for Measured Vs30 values (i.e., Vs30class=1)
      if (vs30_class .eq. 0) then
         F_measured = 0.0
         F_Inferred = 1.0
      elseif (vs30_class .eq. 1) then
         F_measured = 1.0
         F_Inferred = 0.0
      endif

        sigma_NL0 = sigma_NL0 *
     1        sqrt(0.7*F_Measured+F_Inferred*sigma3T+(1+NL0)**2.0)
        sigma = sqrt((tau*(1.0+NL0))**2.0+sigma_NL0**2.0)

      phi = sigma_NL0
      tau = (tau*(1.0+NL0))

C     Convert ground motion to units of gals.
      lnY = psa + 6.89
      period2 = period1

      return
      end






c ---------------------------------------------------------------------
C ** Chiou and Youngs (NGA West2-2013 Model) Horizontal **
C     Earthquake Spectra Paper:
C        Update of the Chiou and Youngs NGA Model for the
C            Average Horizontal Component of Peak
C            Ground Motion and Response Spectra
C         B. S.J. Chiou and R.R. Youngs
C     Notes:
C        Applicable Range (see Abstract):
C           3.5 <= M <= 8.5 Strike-slip
C           3.5 <= M <= 8.0 Reverse and Normal
C           Rrup <= 300 km
C           Ztor <= 20 km
C           180m/s <= Vs30m <= 1500m/s
C           Mainshock events only
C        Regional attenuation included based on Regionflag
C             0 = Global
C             1 = Japan/Italy
C             2 = Wenchuan (note only applicable for M7.9 event)
C         Sigma dependent on estimated or measured Vs30m based on
C             Vs30_Class
C             0 = Estimated Vs30m
C             1 = Measured Vs30m
c ---------------------------------------------------------------------
      Subroutine CY14_TW_C01 ( m, Rrup, Rbjf, specT,
     1                     period2, lnY, sigma, iflag,
     2                     vs, Delta, DTor, Ftype, depthvs10, vs30_class,
     3                     hwflag, Rx, regionflag, phi, tau )
C     Last Updated: 8/1/13
      parameter (MAXPER=25)
      REAL Period(MAXPER), C1(MAXPER), C1a(MAXPER), C1b(MAXPER)
      REAL cn(MAXPER), cm(MAXPER), c5(MAXPER), c6(MAXPER), c8(MAXPER)
      REAL c7(MAXPER), c9(MAXPER), gamma1(MAXPER), gamma2(MAXPER)
      REAL phi1(MAXPER), phi2(MAXPER), phi3(MAXPER), phi4(MAXPER)
      REAL phi5(MAXPER), phi6(MAXPER), phi1jp(MAXPER), phi5jp(MAXPER), phi6jp(MAXPER)
      REAL tau1(MAXPER), tau2(MAXPER), sigma1(MAXPER), sigma2(MAXPER)
      REAL sigma3(MAXPER), c9a(MAXPER)
      REAL c3(MAXPER), gm(MAXPER), c9b(MAXPER)
      Real CHM(MAXPER), C1c(MAXPER), C1d(MAXPER), C7b(MAXPER), C8b(MAXPER)
      real C11(MAXPER), C11B(MAXPER)
      real gscaleJapIt(MAXPER), gscaleWen(MAXPER), sigma2Jap(MAXPER)

      REAL c1T, c1aT, c1bT, cnT, cmT, c5T, c6T, c7T, c9T, c9aT, c3T, c8T
      REAL gamma1T, gamma2T, phi1T, phi2T, phi3T, phi4T, sigma3T
      REAL phi5T, phi6T, tau1T, tau2T, sigma1T, sigma2T
      real C1cT, C1dT, C7bT, C11T, C11bT, CHMT
      REAL c2, c4, c4a, cRB, pi, d2r, gamma, gmT, c9bT
      real cc, cosdelta, r1, r2, r3, r4, hw, psa_ref, psa, a, b, c
      integer iflag, count1, count2, hwflag, vs30_class, regionflag
      REAL M, RRUP, RBJF, DTOR, Delta, specT, sigma, Ftype, Rx
      REAL period2, lnY, F_RV, F_NM, depthvs10, tau, rkdepth
      real c8a, c8bT, deltaZ1, fd
      real NL0, sigma_NL0, F_Measured, F_Inferred, mz_TOR, deltaZ_TOR, coshM
      real gscaleJapItT, gscaleWenT, sigma2JapT, phi
      real phi1jpT, phi5jpT, phi6jpT


      Data period(1:25) / 0, 0.01, 0.02, 0.03, 0.04, 0.05, 0.075, 0.1, 0.12, 0.15, 0.17, 0.2, 0.25, 0.3, 0.4, 0.5, 0.75, 1, 1.5, 2,
     1      3, 4, 5, 7.5, 10/
      Data c1(1:25) / -1.31266420077258, -1.31266420077258, -1.27052159841083, -1.15311329373526, -1.00621910291969,
     1      -0.847745315342867, -0.506698132668687, -0.34011520483206, -0.304795250685725, -0.376848741110481, -0.437416783354322,
     1      -0.536485802809589, -0.705314012467511, -0.884076206174429, -1.25954659234479, -1.57601313090642, -2.13561675748938,
     1      -2.43819675871175, -2.86642751914157, -3.04157367665102, -3.45879762569914, -3.67827599612404, -3.80553683316369,
     1      -4.14696033561859, -4.59281925797601/
      Data c1a(1:25) / 0.18246709014369, 0.18246709014369, 0.178309224403595, 0.158716871514361, 0.136398107463104,
     1      0.11936121227405, 0.107073183963987, 0.159893513444579, 0.222972184210787, 0.297692608763902, 0.311114442939766,
     1      0.310324821840864, 0.369412804286422, 0.434878712929772, 0.489932697682775, 0.52782991756011, 0.459542012425824,
     1      0.363115431495551, 0.234026514862835, 0.173812951157414, 0.064526297612305, -0.0890925475898438, -0.168344291391401,
     1      -0.389030032261896, -0.365470360970178/
      Data c1b(1:25) / -0.167760549207099, -0.167760549207099, -0.151515173695688, -0.163132859539498, -0.162472505617202,
     1      -0.221893645353074, -0.284833283451462, -0.269908988021925, -0.253098159297076, -0.167316655333099, -0.128183304040673,
     1      -0.0815500335830345, -0.0388320763843968, -0.0710297213106874, -0.0831223427861709, -0.117869383232857,
     1      -0.168476132541299, -0.338866311701415, -0.453619201467275, -0.452653695489928, -0.320455666547956,
     1      -0.0163505888400868, -0.0385758573257073, -0.0688076694199481, -0.201948320081607/
      Data c1c(1:25) / 0.108289511741018, 0.108289511741018, 0.117493112308231, 0.166099933928779, 0.236069585545508,
     1      0.287333206939413, 0.290840813361722, 0.140626983543901, -0.00892928682460603, -0.178471416007927, -0.202091399690708,
     1      -0.179864089834803, -0.296685382036618, -0.422875653161692, -0.484879731863843, -0.532238646990341, -0.3777514162866,
     1      -0.181032482609988, -0.0234286549494071, 0.0430130382831375, 0.172098227714921, 0.377617402576038, 0.445213852683411,
     1      0.641855063614217, 0.678886019451774/
      Data c1d(1:25) / 0.305816299049586, 0.305816299049586, 0.287611795011559, 0.323395585491379, 0.380558607840273,
     1      0.499784003610166, 0.562091379441839, 0.407925321289974, 0.393524081511871, 0.305684778605879, 0.219827912926136,
     1      0.13378053808553, 0.0446584872502858, 0.10219487164099, 0.122601530820636, 0.100196434191248, 0.141479092793457,
     1      0.353765525486546, 0.551135413760324, 0.596493950421738, 0.623873999403419, 0.543943402945403, -0.101415672062659,
     1      0.0891998953807712, 0.00297285487244325/
      Data cn(1:25) / 16.0875, 16.0875, 15.7118, 15.8819, 16.4556, 17.6453, 20.1772, 19.9992, 18.7106, 16.6246, 15.3709, 13.7012,
     1      11.2667, 9.1908, 6.5459, 5.2305, 3.7896, 3.3024, 2.8498, 2.5417, 2.1488, 1.8957, 1.7228, 1.5737, 1.5265/
      Data cM(1:25) / 4.9993, 4.9993, 4.9993, 4.9993, 4.9993, 4.9993, 5.0031, 5.0172, 5.0315, 5.0547, 5.0704, 5.0939, 5.1315,
     1      5.167, 5.2317, 5.2893, 5.4109, 5.5106, 5.6705, 5.7981, 5.9983, 6.1552, 6.2856, 6.5428, 6.7415/
      Data c3(1:25) / 1.16592367966216, 1.16592367966216, 1.12830120699638, 1.07978867952166, 1.06523941578527, 1.04218816686773,
     1      1.14153732705161, 1.14747191330801, 1.18716213766583, 1.24109745493194, 1.29977223747474, 1.40201902033596,
     1      1.51446360204558, 1.64340184698047, 1.77923120143032, 1.85464518277339, 2.21522772742916, 2.60354231791946,
     1      2.9855138517209, 3.15987852562695, 3.26159427177443, 3.30665315926803, 3.27930774108803, 3.19724048046314,
     1      3.00085309764975/
      Data c5(1:25) / 6.4551, 6.4551, 6.4551, 6.4551, 6.4551, 6.4551, 6.4551, 6.8305, 7.1333, 7.3621, 7.4365, 7.4972, 7.5416, 7.56,
     1      7.5735, 7.5778, 7.5808, 7.5814, 7.5817, 7.5818, 7.5818, 7.5818, 7.5818, 7.5818, 7.5818/
      Data cHM(1:25) / 3.0956, 3.0956, 3.0963, 3.0974, 3.0988, 3.1011, 3.1094, 3.2381, 3.3407, 3.43, 3.4688, 3.5146, 3.5746,
     1      3.6232, 3.6945, 3.7401, 3.7941, 3.8144, 3.8284, 3.833, 3.8361, 3.8369, 3.8376, 3.838, 3.838/
      Data c6(1:25) / 0.4908, 0.4908, 0.4925, 0.4992, 0.5037, 0.5048, 0.5048, 0.5048, 0.5048, 0.5045, 0.5036, 0.5016, 0.4971,
     1      0.4919, 0.4807, 0.4707, 0.4575, 0.4522, 0.4501, 0.45, 0.45, 0.45, 0.45, 0.45, 0.45/
      Data c7(1:25) / 0.0206913326016277, 0.0206913326016277, 0.0207295305470051, 0.0207758273344614, 0.0213063949326634,
     1      0.0223491127548945, 0.0242401920598548, 0.0280050260478514, 0.0275296793481186, 0.0284827099580447, 0.0288451884510878,
     1      0.0273907953297194, 0.0238321506745443, 0.0213283545610859, 0.0202646590294867, 0.0195915595381851, 0.0166455490057581,
     1      0.0141714984212119, 0.0118838505771454, 0.0104635707293479, 0.00237705091080518, -0.00600975826092364,
     1      -0.0108012350729907, -0.0152387032851066, -0.0180976550452297/
      Data c7b(1:25) / 0.0193395871686318, 0.0193395871686318, 0.0196111041243464, 0.0219350089169555, 0.0238886678030938,
     1      0.0246148494646156, 0.0235295139674962, 0.0138917888720577, 0.0124974976814102, 0.00630765722218034,
     1      0.00482354753413154, 0.00397587341462028, 0.00611253593560759, 0.0087913752708122, 0.0076244392096242,
     1      0.00504899023750188, 0.00672890981765682, 0.00910206491385782, 0.00562559209974137, 0.00605716808870929,
     1      0.00765199592400173, 0.0221861811513163, 0.0312372545353795, 0.0483241134635139, 0.0652336102841609/
      Data c8b(1:25) / 0.4833, 0.4833, 1.2144, 1.6421, 1.9456, 2.181, 2.6087, 2.9122, 3.1045, 3.3399, 3.4719, 3.6434, 3.8787,
     1      4.0711, 4.3745, 4.6099, 5.0376, 5.3411, 5.7688, 6.0723, 6.5, 6.8035, 7.0389, 7.4666, 7.77/
      Data c9(1:25) / 0.9228, 0.9228, 0.9296, 0.9396, 0.9661, 0.9794, 1.026, 1.0177, 1.0008, 0.9801, 0.9652, 0.9459, 0.9196,
     1      0.8829, 0.8302, 0.7884, 0.6754, 0.6196, 0.5101, 0.3917, 0.1244, 0.0086, 0, 0, 0/
      Data c9a(1:25) / 0.1202, 0.1202, 0.1217, 0.1194, 0.1166, 0.1176, 0.1171, 0.1146, 0.1128, 0.1106, 0.115, 0.1208, 0.1208,
     1      0.1175, 0.106, 0.1061, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1/
      Data c9b(1:25) / 6.8607, 6.8607, 6.8697, 6.9113, 7.0271, 7.0959, 7.3298, 7.2588, 7.2372, 7.2109, 7.2491, 7.2988, 7.3691,
     1      6.8789, 6.5334, 6.526, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5, 6.5/
      Data c11(1:25) / 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0/
      Data c11b(1:25) / -0.4536, -0.4536, -0.4536, -0.4536, -0.4536, -0.4536, -0.4536, -0.4536, -0.4536, -0.4536, -0.4536, -0.444,
     1      -0.3539, -0.2688, -0.1793, -0.1428, -0.1138, -0.1062, -0.102, -0.1009, -0.1003, -0.1001, -0.1001, -0.1, -0.1/
      Data gamma1(1:25) / -0.00783493702135279, -0.00783493702135279, -0.00786128761621098, -0.00778079877094438,
     1      -0.00780076858327062, -0.00810910287093641, -0.00912151012877523, -0.0106273581887152, -0.0110305348350741,
     1      -0.0122773873835144, -0.0123798742277027, -0.012084026107517, -0.0113593004922249, -0.0100391491127564,
     1      -0.00770496369836205, -0.00593665980807693, -0.00477597053626469, -0.00578040071664831, -0.00715653723401061,
     1      -0.00843770016421773, -0.00717222257275659, -0.00610799690698496, -0.00476134903941374, -0.00377468396919992,
     1      -0.00158837559327459/
      Data gamma2(1:25) / -0.0153089549093592, -0.0153089549093592, -0.0156946231637086, -0.0180473134509439, -0.0196742447234555,
     1      -0.019990050777154, -0.0178990960171151, -0.0127698636872442, -0.0102565070902433, -0.00547601025969077,
     1      -0.00389061715956447, -0.00242026662929076, -0.000968015013739525, -0.00143340361892399, -0.00209160361537034,
     1      -0.00326463289495902, -0.00426625880121567, -0.00254580133231734, 0.003706273954965, 0.00606790118927974,
     1      0.00770828253872531, 0.00687887371514652, 0.00257091239027114, 0.00221896024249813, -0.00410767355413492/
      Data gm(1:25) / 4.2542, 4.2542, 4.2386, 4.2519, 4.296, 4.3578, 4.5455, 4.7603, 4.8963, 5.0644, 5.1371, 5.188, 5.2164, 5.1954,
     1      5.0899, 4.7854, 4.3304, 4.1667, 4.0029, 3.8949, 3.7928, 3.7443, 3.709, 3.6632, 3.623/
      Data phi1(1:25) / -0.478295601468722, -0.478295601468722, -0.469350764099948, -0.46172967994569, -0.451078399262125,
     1      -0.434858964898445, -0.425178256509881, -0.430145396922332, -0.446790915722155, -0.465667035381067, -0.482521496092297,
     1      -0.493897938945111, -0.492815169820979, -0.532833891414964, -0.589495724586852, -0.62420819116978, -0.787788908491935,
     1      -0.901784713782365, -1.00639980254843, -1.02277834678832, -1.04028777564407, -1.04611389204112, -0.997886189821876,
     1      -0.933873385132495, -0.837232537244328/
      Data phi2(1:25) / -0.1417, -0.1417, -0.1364, -0.1403, -0.1591, -0.1862, -0.2538, -0.2943, -0.3077, -0.3113, -0.3062, -0.2927,
     1      -0.2662, -0.2405, -0.1975, -0.1633, -0.1028, -0.0699, -0.0425, -0.0302, -0.0129, -0.0016, 0, 0, 0/
      Data phi3(1:25) / -4.96041757793564, -4.96041757793564, -4.92276178884602, -4.91251089610306, -4.96513625402504,
     1      -5.04104295651768, -5.16134191152096, -5.18427465050738, -5.16799110487246, -5.14216868405811, -5.1228525972173,
     1      -5.09276768363488, -5.04538203042609, -5.00505091580236, -4.94414555282742, -4.90155669907002, -4.81342512480855,
     1      -4.77429914899606, -4.86562627218628, -5.34080741816899, -6.30453280595018, -6.48707320506911, -6.54311216539423,
     1      -6.59367473267582, -6.59953555531281/
      Data phi4(1:25) / -2.28130316824122, -2.28130316824122, -2.22229626176524, -2.12119730536018, -2.01259817873199,
     1      -1.90429902597891, -1.65759927434112, -1.4668018434511, -1.37369802906703, -1.32250111763273, -1.3277990635296,
     1      -1.36550006882328, -1.4629983153057, -1.5736992160094, -1.79900163048511, -2.01119988561788, -2.46330564055044,
     1      -2.83710591027157, -3.44869787781101, -3.92632479013901, -4.64152301545389, -5.22525279569103, -5.73744267614884,
     1      -6.78200407367658, -7.57134365730054/
      Data phi5(1:25) / 0.0139926199706649, 0.0139926199706649, 0.0137650452723175, 0.0140339515445724, 0.0173393648081361,
     1      0.0221061501659787, 0.0416600809735219, 0.0637396168303911, 0.0508535274577875, 0.041714225815666, 0.0309579228046502,
     1      0.025016098336011, 0.0264586215769839, 0.0225557672812644, 0.0174484052235742, -0.000523452997460243,
     1      -0.0150610705243032, -0.00345810627559283, 0.0631461836018504, 0.0955736653255159, 0.130800857675134,
     1      0.128174100854778, 0.125397135621374, 0.130974459736013, 0.115120841547345/
      Data phi6(1:25) / 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300,
     1      300, 300, 300, 300/
      Data tau1(1:25) / 0.4, 0.4, 0.40260697107594, 0.406254677901244, 0.409536599100115, 0.412362151356064, 0.417868294570895,
     1      0.421889928589278, 0.424427487574697, 0.427481452707345, 0.429157682348667, 0.431284929241235, 0.434101130455258,
     1      0.436302393283048, 0.439579110622969, 0.441948893180584, 0.445868511544276, 0.448355188391465, 0.451470005001172,
     1      0.453423408395737, 0.455849456889221, 0.457360780855491, 0.458424490145996, 0.460138736069957, 0.461201624142458/
      Data tau2(1:25) / 0.26, 0.26, 0.2637242443942, 0.268935254144634, 0.273623713000165, 0.277660216222949, 0.285526135101279,
     1      0.291271326556111, 0.294896410820996, 0.29925921815335, 0.301653831926667, 0.304692756058908, 0.308715900650368,
     1      0.311860561832925, 0.316541586604241, 0.319926990257977, 0.325526445063252, 0.329078840559236, 0.333528578573103,
     1      0.336319154851053, 0.339784938413173, 0.341943972650702, 0.343463557351422, 0.345912480099939, 0.347430891632083/
      Data sigma1(1:25) / 0.491174072226289, 0.491174072226289, 0.490392102266757, 0.49884629286719, 0.504893375136174,
     1      0.509564336873576, 0.517904200145505, 0.523587992281292, 0.526987000584287, 0.530830818870199, 0.532795897236441,
     1      0.535092985589259, 0.537693444822054, 0.539459005039374, 0.542235827503619, 0.543286483861406, 0.529446500271604,
     1      0.510487062001946, 0.478270612673322, 0.468082689790949, 0.461651268718433, 0.457088102848047, 0.453548636419445,
     1      0.447117215346928, 0.442554049476542/
      Data sigma2(1:25) / 0.376232982006498, 0.376232982006498, 0.376232982006498, 0.384851051972815, 0.390965669923574,
     1      0.395708536077288, 0.404326606043605, 0.410441223994364, 0.414316427806967, 0.419059293960682, 0.421719608502208,
     1      0.42517391191144, 0.429916778065155, 0.433791981877758, 0.439906599828517, 0.444649465982231, 0.453267535948548,
     1      0.459382153899307, 0.468000223865624, 0.468082689790949, 0.461651268718433, 0.457088102848047, 0.453548636419445,
     1      0.447117215346928, 0.442554049476542/
      Data sigma3(1:25) / 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.7999, 0.7997, 0.7988, 0.7966, 0.7792,
     1      0.7504, 0.7136, 0.7035, 0.7006, 0.7001, 0.7, 0.7, 0.7/
      Data gscaleJapIt(1:25) / 1.581682, 1.581682, 1.574012, 1.554376, 1.550154, 1.539148, 1.480416, 1.40939, 1.368192, 1.324078,
     1      1.307137, 1.293133, 1.314989, 1.351437, 1.405064, 1.440233, 1.52797, 1.652328, 1.887186, 2.134757, 3.575186, 3.864586,
     1      3.729218, 2.376267, 1.767935/
      Data phi1Jp(1:25) / -0.684621362856666, -0.684621362856666, -0.668104490153807, -0.631364652348356, -0.585522686567435,
     1      -0.545659123699481, -0.468510173737368, -0.498485421565652, -0.560262194908129, -0.645129113225058, -0.698050600056553,
     1      -0.765310551536843, -0.846945325590174, -0.899885267655382, -0.961772613950091, -0.994485940646074, -1.02254530165975,
     1      -1.0001741238606, -0.924505251934862, -0.862638634236657, -0.788170491672007, -0.719494506504419, -0.655991993310966,
     1      -0.520223846723544, -0.406803274628334/
      Data phi5Jp(1:25) / 0.459, 0.459, 0.458, 0.462, 0.453, 0.436, 0.383, 0.375, 0.377, 0.379, 0.38, 0.384, 0.393, 0.408, 0.462,
     1      0.524, 0.658, 0.78, 0.96, 1.11, 1.291, 1.387, 1.433, 1.46, 1.464/
      Data phi6Jp(1:25) / 800, 800, 800, 800, 800, 800, 800, 800, 800, 800, 800, 800, 800, 800, 800, 800, 800, 800, 800, 800, 800,
     1      800, 800, 800, 800/
      Data gscaleWen(1:25) / 0.75937, 0.75937, 0.760565, 0.76416, 0.767627, 0.773871, 0.795556, 0.79319, 0.776833, 0.743674,
     1      0.721908, 0.692222, 0.657901, 0.636173, 0.604851, 0.550656, 0.358158, 0.200263, 0.035633, 0, 0, 0, 0, 0, 0/
      Data sigma2jap(1:25) / 0.452832136505141, 0.452832136505141, 0.455081474488854, 0.457089607558063, 0.464232248075043,
     1      0.471593304149618, 0.502235058788957, 0.522972224766759, 0.527828908598616, 0.530427671390517, 0.530985974389397,
     1      0.531176947346726, 0.53091866775, 0.53069348684478, 0.530953922960708, 0.531256171294916, 0.530904125925903,
     1      0.53016308922439, 0.527603492956116, 0.516719512970182, 0.491681001472351, 0.468235579988731, 0.451748161403632,
     1      0.416734686252964, 0.375505067353143/
      Data c8(1:25) / 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0991, 0.1982, 0.2154, 0.2154, 0.2154, 0.2154,
     1      0.2154, 0.2154, 0.2154, 0.2154/


C Find the requested spectral period and corresponding coefficients
      nPer = 25
C First check for the PGA case (i.e., specT=0.0)
      if (specT .eq. 0.0) then
         period1  = period(1)
         c1T      = c1(1)
         c1aT     = c1a(1)
         c1bT     = c1b(1)
         c1cT     = c1c(1)
         c1dT     = c1d(1)
         c3T      = c3(1)
         cHMT     = CHM(1)
         cnT      = cn(1)
         cmT      = cm(1)
         c5T      = c5(1)
         c6T      = c6(1)
         c7T      = c7(1)
         c7bT      = c7b(1)
         c8bT      = c8b(1)
         c9T      = c9(1)
         c9aT      = c9a(1)
         c9bT      = c9b(1)
         c11T      = c11(1)
         c11bT      = c11b(1)
         gamma1T  = gamma1(1)
         gamma2T  = gamma2(1)
         gmT      = gm(1)
         phi1T    = phi1(1)
         phi2T    = phi2(1)
         phi3T    = phi3(1)
         phi4T    = phi4(1)
         phi5T    = phi5(1)
         phi6T    = phi6(1)
         tau1T    = tau1(1)
         tau2T    = tau2(1)
         sigma1T = sigma1(1)
         sigma2T = sigma2(1)
         sigma2JapT = sigma2Jap(1)
         sigma3T = sigma3(1)
         gscaleJapItT = gscaleJapIt(1)
         phi1jpT = phi1jp(1)
         phi5jpT = phi5jp(1)
         phi6jpT = phi6jp(1)
         gscaleWenT = gscaleWen(1)
         c8T = c8(1)
         goto 1011
      elseif (specT .gt. 0.0) then
C Now loop over the spectral period range of the attenuation relationship.
         do i=2,nper-1
            if (specT .ge. period(i) .and. specT .le. period(i+1) ) then
               count1 = i
               count2 = i+1
               goto 1020
            endif
         enddo
      endif
C Selected spectral period is outside range defined by attenuaton model.
c     write statement removed for R package compliance
c     write statement removed for R package compliance
c     write statement removed for R package compliance
c     write statement removed for R package compliance
c     write statement removed for R package compliance
c     write statement removed for R package compliance
c     write statement removed for R package compliance
c     write statement removed for R package compliance
c     write statement removed for R package compliance
c     write statement removed for R package compliance
      return
C Interpolate the coefficients for the requested spectral period.
 1020       call interp (period(count1),period(count2),c1(count1),c1(count2),
     +                   specT,c1T,iflag)
            call interp (period(count1),period(count2),c1a(count1),c1a(count2),
     +                   specT,c1aT,iflag)
            call interp (period(count1),period(count2),c1b(count1),c1b(count2),
     +                   specT,c1bT,iflag)
            call interp (period(count1),period(count2),c1c(count1),c1c(count2),
     +                   specT,c1cT,iflag)
            call interp (period(count1),period(count2),c1d(count1),c1d(count2),
     +                   specT,c1dT,iflag)
            call interp (period(count1),period(count2),cn(count1),cn(count2),
     +                   specT,cnT,iflag)
            call interp (period(count1),period(count2),cm(count1),cm(count2),
     +                   specT,cmT,iflag)
            call interp (period(count1),period(count2),cHM(count1),cHM(count2),
     +                   specT,cHMT,iflag)
            call interp (period(count1),period(count2),c3(count1),c3(count2),
     +                   specT,c3T,iflag)
            call interp (period(count1),period(count2),c5(count1),c5(count2),
     +                   specT,c5T,iflag)
            call interp (period(count1),period(count2),c6(count1),c6(count2),
     +                   specT,c6T,iflag)
            call interp (period(count1),period(count2),c7(count1),c7(count2),
     +                   specT,c7T,iflag)
            call interp (period(count1),period(count2),c7b(count1),c7b(count2),
     +                   specT,c7bT,iflag)
            call interp (period(count1),period(count2),c8b(count1),c8b(count2),
     +                   specT,c8bT,iflag)
            call interp (period(count1),period(count2),c9(count1),c9(count2),
     +                   specT,c9T,iflag)
            call interp (period(count1),period(count2),c9a(count1),c9a(count2),
     +                   specT,c9aT,iflag)
            call interp (period(count1),period(count2),c9b(count1),c9b(count2),
     +                   specT,c9bT,iflag)
            call interp (period(count1),period(count2),c11(count1),c11(count2),
     +                   specT,c11T,iflag)
            call interp (period(count1),period(count2),c11b(count1),c11b(count2),
     +                   specT,c11bT,iflag)
            call interp (period(count1),period(count2),gamma1(count1),gamma1(count2),
     +                   specT,gamma1T,iflag)
            call interp (period(count1),period(count2),gamma2(count1),gamma2(count2),
     +                   specT,gamma2T,iflag)
            call interp (period(count1),period(count2),gm(count1),gm(count2),
     +                   specT,gmT,iflag)
            call interp (period(count1),period(count2),phi1(count1),phi1(count2),
     +                   specT,phi1T,iflag)
            call interp (period(count1),period(count2),phi2(count1),phi2(count2),
     +                   specT,phi2T,iflag)
            call interp (period(count1),period(count2),phi3(count1),phi3(count2),
     +                   specT,phi3T,iflag)
            call interp (period(count1),period(count2),phi4(count1),phi4(count2),
     +                   specT,phi4T,iflag)
            call interp (period(count1),period(count2),phi5(count1),phi5(count2),
     +                   specT,phi5T,iflag)
            call interp (period(count1),period(count2),phi6(count1),phi6(count2),
     +                   specT,phi6T,iflag)
            call interp (period(count1),period(count2),tau1(count1),tau1(count2),
     +                   specT,tau1T,iflag)
            call interp (period(count1),period(count2),tau2(count1),tau2(count2),
     +                   specT,tau2T,iflag)
            call interp (period(count1),period(count2),sigma1(count1),sigma1(count2),
     +                   specT,sigma1T,iflag)
            call interp (period(count1),period(count2),sigma2(count1),sigma2(count2),
     +                   specT,sigma2T,iflag)
            call interp (period(count1),period(count2),sigma2Jap(count1),sigma2Jap(count2),
     +                   specT,sigma2JapT,iflag)
            call interp (period(count1),period(count2),sigma3(count1),sigma3(count2),
     +                   specT,sigma3T,iflag)
            call interp (period(count1),period(count2),gscaleJapIt(count1),gscaleJapIt(count2),
     +                   specT,gscaleJapItT,iflag)
            call interp (period(count1),period(count2),phi1jp(count1),phi1jp(count2),
     +                   specT,phi1jpT,iflag)
            call interp (period(count1),period(count2),phi5jp(count1),phi5jp(count2),
     +                   specT,phi5jpT,iflag)
            call interp (period(count1),period(count2),phi6jp(count1),phi6jp(count2),
     +                   specT,phi6jpT,iflag)
            call interp (period(count1),period(count2),gscaleWen(count1),gscaleWen(count2),
     +                   specT,gscaleWenT,iflag)
            call interp (period(count1),period(count2),c8(count1),c8(count2),
     +                   specT,c8T,iflag)
 1011 period1 = specT
c     Set the fault mechanism term.
C     fType     Mechanism                      Rake
C     ------------------------------------------------------
C      -1       Normal                   -120 < Rake < -60.0
C     1, 0.5    Reverse and Rev/Obl        30 < Rake < 150.0
C     0,-0.5    Strike-Slip and NMl/Obl        Otherwise
         if (ftype .eq. -1) then
            F_RV = 0.0
            F_NM = 1.0
         elseif (ftype .ge. 0.5) then
            F_RV = 1.0
            F_NM = 0.0
         else
            F_RV = 0.0
            F_NM = 0.0
         endif
C     Constant terms
        c2 = 1.06
        c4 = -2.1
        c4a = -0.5
        cRB = 50.0
C        c8 = 0.2154
        c8a = 0.2695
        pi = atan(1.0)*4.0
        d2r = pi/180.0
        cc = c5T* cosh(c6T * max((M-cHMT),0.0))
        gamma = gamma1T + gamma2T/cosh(max((M-gmT),0.0))
C     Apply Regional scaling factor.
C     Regionflag = 0 Global
C     Regionflag = 1 Japan and Italy
C        Also set sigma2 equal to Japan specific value
C     Regionflag = 2 Wenchuan (note only for M7.9)
c        if (regionflag .eq. 1 ) then
c           gamma = gamma * gscaleJapItT
c           sigma2T = sigma2JapT
c        elseif (regionflag .eq. 2) then
c           gamma = gamma * gscaleWenT
c        endif
c        cosDELTA = cos(abs(DELTA)*d2r)
c Magnitude scaling
        r1 = c1T + c2 * (M-6.0) +
     1       (c2-c3T)/cnT *
     1             alog(1.0 + exp(-cnT*(M-cMT)))
c Near-field magnitude and distance scaling
        r2 = c4 * alog(Rrup + cc)
c Distance scaling at large distance
        r3 = (c4a-c4)/2.0 *
     1            alog( Rrup*Rrup+cRB*cRB ) +
     1       Rrup * gamma
c Center Z_TOR on the Z_TOR-M relation in Chiou and Youngs (2013)
        if (F_RV.EQ.1) then
          if (M .le. 5.849) then
              mZ_TOR = 2.704*2.704
          else
              mZ_TOR = max(2.704-1.226*(M-5.849), 0.0)
              mZ_TOR = mZ_TOR * mZ_TOR
          endif
        else
          if (M .le. 4.970) then
              mZ_TOR = 2.673*2.673
          else
              mZ_TOR = max(2.673-1.136*(M-4.970), 0.0)
              mZ_TOR = mZ_TOR * mZ_TOR
          endif
        endif
        deltaZ_TOR = Dtor - 2*mZ_TOR

c Scaling with other source variables (F_RV, F_NM, deltaZ_TOR, and Dip)
        coshM = cosh(2*max(M-4.5,0.0))
        cosDELTA = cos(DELTA*d2r)
        r4 = (c1aT+c1cT/coshM) * F_RV +
     1       (c1bT+c1dT/coshM) * F_NM +
     1       (c7T +c7bT/coshM) * deltaZ_TOR +
     1       (c11T+c11bT/coshM)* cosDELTA**2

c HW effect
        if (HWFlag .eq. 0) then
           hw = 0.0
        else
         hw = c9T * (cosDELTA) * (c9aT+(1-c9aT)
     1        *tanh(abs(Rx)/c9bT)) *
     1          (1.0 - sqrt(Rbjf**2+DTor**2)/(Rrup + 1))
        endif
C     Current version of the code sets cDPP=0 (i.e., no directivity)
c Directivity effect
        cDPP = 0.0
        fd = c8T * exp(-c8aT * (M-c8bT)**2) *
     1       max(0.0, 1.0-max(0.0,Rrup-40.0)/30.0) *
     1       min(max(0.0,M-5.5)/0.8, 1.0) * cDPP
c Predicted median Sa on reference condition (Vs=1130 m/sec)
c        fd = 0.0
        psa_ref = r1+r2+r3+r4+hw+fd
C     Set Phi1, Phi5, and Phi6 term for Japan is region is requested
c        if (regionflag .eq. 1) then
c           phi1T = phi1jpT
c           phi5T = phi5jpT
c           phi6T = phi6jpT
c        endif

c Linear soil amplification
        a = phi1T * min(alog(Vs/1130.0), 0.0)
c Nonlinear soil amplification
        b = phi2T *
     1      (exp(-exp(phi3T)*(min(Vs,1130.0)-360.0)) - exp(-exp(phi3T)*(1130.0-360.0)))
        c = exp(phi4T)
C Deviation from ln(Vs30) scaling: bedrock depth (Z1) effect.
c        if (regionflag .eq. 1) then
c           deltaZ1 = depthvs10*1000.0 -
c     1     exp(-5.23/2.0 * alog((VS**2.0 + 412.0**2.0)/(1360.0**2.0 + 412.0**2.0)))
c        else
           deltaZ1 = depthvs10*1000.0 -
     1     exp(-2.63 / 4.0 * alog((VS**4.0 + 253.0**4.0)/(2492.0**4.0 + 253.0**4.0)))
c        endif
        rkdepth = phi5T * ( 1.0 - exp(-deltaZ1/phi6T ) )
c Sa on soil condition
        psa = psa_ref + (a + b * alog((exp(psa_ref)+c)/c)) + rkdepth
C Compute the sigma term
        NL0 = b * exp(psa_ref)/(exp(psa_ref)+c)
        tau = tau1T +
     1            (tau2T-tau1T)/1.5*(min(max(M,5.0),6.5)-5.0)
        sigma_NL0 = sigma1T +
     1              (sigma2T-sigma1T)/1.5*(min(max(M,5.0),6.5)-5.0)
C     Current code set for Measured Vs30 values (i.e., Vs30class=1)
      if (vs30_class .eq. 0) then
         F_measured = 0.0
         F_Inferred = 1.0
      elseif (vs30_class .eq. 1) then
         F_measured = 1.0
         F_Inferred = 0.0
      endif
        sigma_NL0 = sigma_NL0 *
     1        sqrt(0.7*F_Measured+F_Inferred*sigma3T+(1+NL0)**2.0)
        sigma = sqrt((tau*(1.0+NL0))**2.0+sigma_NL0**2.0)
      phi = sigma_NL0
      tau = (tau*(1.0+NL0))

C     Convert ground motion to units of gals.
      lnY = psa + 6.89
      period2 = period1
      return
      end
